files:
  "/tmp/debug_network.sh":
    mode: "000755"
    owner: root
    group: root
    content: |
      #!/bin/bash
      
      echo "STARTING NETWORK DIAGNOSTICS..."
      echo "==============================="
      echo "Container routing table:"
      docker exec $(docker ps -q) route -n
      
      echo "==============================="
      echo "Testing connectivity from EC2 to Load Balancer:"
      curl -v http://127.0.0.1:80/health/
      
      echo "==============================="
      echo "Testing connectivity to application directly:"
      curl -v http://127.0.0.1:8000/health/
      
      echo "==============================="
      echo "Checking Nginx configuration:"
      nginx -T
      
      echo "==============================="
      echo "Checking open ports:"
      netstat -tulpn | grep -E ':(80|8000)'
      
      echo "==============================="
      echo "Testing external DNS resolution:"
      dig green-env-usw1.us-west-1.elasticbeanstalk.com
      
      echo "==============================="
      echo "DIAGNOSTICS COMPLETE"

container_commands:
  01_run_network_debug:
    command: "bash /tmp/debug_network.sh > /var/log/network_debug.log 2>&1"
