files:
  "/tmp/check_db.py":
    mode: "000755"
    owner: root
    group: root
    content: |
      #!/usr/bin/env python3
      import socket
      import sys
      
      # Database host from your settings.py
      db_host = "movementor-django-db.cfuoimgmmxni.us-west-1.rds.amazonaws.com"
      db_port = 5432
      
      print(f"Testing connection to {db_host}:{db_port}...")
      
      try:
          # Try to establish a TCP connection
          sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
          sock.settimeout(5)  # 5 second timeout
          result = sock.connect_ex((db_host, db_port))
          
          if result == 0:
              print("Connection successful! Database is reachable.")
          else:
              print(f"Connection failed with error code: {result}")
          
          sock.close()
      except Exception as e:
          print(f"Exception occurred: {e}")
      
      print("Network diagnostic complete.")

container_commands:
  01_run_db_diagnostic:
    command: "python /tmp/check_db.py > /var/log/db_diagnostic.log 2>&1"
    ignoreErrors: true